import{r as e,R as t,j as a,g as r,b as i,l as s,u as n,a as l,A as c}from"./index-u5DnuwxY.js";import{w as o,c as d,e as m,m as u,i as h,z as p,h as x,d as g}from"./spin-loading-DwfaOn8j.js";import{L as f}from"./LeftOutline-BdLPOPaU.js";import{T as v}from"./index-YkkJrYC_.js";import{j as y,w as j,d as N,n as C,F as b,l as w,A as k,L as R,T as E}from"./index-D3j6A6ZS.js";function L(t){return e.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},t,{style:Object.assign({verticalAlign:"-0.125em"},t.style),className:["antd-mobile-icon",t.className].filter(Boolean).join(" ")}),e.createElement("g",{id:"SendOutline-SendOutline",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},e.createElement("g",{id:"SendOutline-编组"},e.createElement("rect",{id:"SendOutline-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),e.createElement("path",{d:"M24.9998666,4.39999998 L24.9991334,6.59900002 C24.9988997,6.81985136 24.8198514,6.99885187 24.599,6.99902667 L10,7 L10,7 C8.40231912,7 7.09633912,8.24891996 7.00509269,9.82372721 L7,10 L7,38 C7,39.5976809 8.24891996,40.9036609 9.82372721,40.9949073 L10,41 L38,41 C39.5976809,41 40.9036609,39.75108 40.9949073,38.1762728 L41,38 L40.9990267,23.4 C40.9989853,23.1790861 41.1780594,22.9999881 41.3989733,22.9999733 C41.3989822,22.9999733 41.3989911,22.9999733 41.399,23 L43.6,23 C43.8209139,23 44,22.8209139 44,22.6 L44,17.4 C44,17.1790861 43.8209139,17 43.6,17 L41.4,17 C41.1791022,16.9999587 41.0000228,16.8208978 40.9999587,16.6 L40.9991652,8.914 L40.9991652,8.914 L26.5653182,23.3488752 C26.4091241,23.5051006 26.1558581,23.5051096 25.9996429,23.3489054 C25.9996395,23.3489021 25.9996362,23.3488987 25.9996429,23.3488853 L24.4440079,21.7932504 C24.2878173,21.6370323 24.2878112,21.3837769 24.4439942,21.2275512 L38.6701652,7 L38.6701652,7 L31.4,7 C31.1790861,7 31,6.8209139 31,6.6 L31,4.4 C31,4.1790861 31.1790861,4 31.4,4 L42.5,4 L42.5,4 C43.3284271,4 44,4.67157288 44,5.5 L44,38 C44,41.3137085 41.3137085,44 38,44 L10,44 C6.6862915,44 4,41.3137085 4,38 L4,10 C4,6.6862915 6.6862915,4 10,4 L24.6,4 C24.8209139,3.99986664 25,4.17895274 25,4.39986664 C25,4.3999111 25,4.39995556 24.9998666,4.39999998 Z",id:"SendOutline-路径",fill:"currentColor",fillRule:"nonzero"}))))}const P="adm-card",D=e=>o(e,t.createElement("div",{className:P,onClick:e.onClick},e.title||e.extra?t.createElement("div",{className:d(`${P}-header`,e.headerClassName),style:e.headerStyle,onClick:e.onHeaderClick},e.icon&&t.createElement("div",{className:`${P}-header-icon`},e.icon),t.createElement("div",{className:`${P}-header-title`},e.title),e.extra&&t.createElement("div",{className:`${P}-header-extra`},e.extra)):null,e.children?t.createElement("div",{className:d(`${P}-body`,e.bodyClassName),style:e.bodyStyle,onClick:e.onBodyClick},e.children):null)),O="adm-nav-bar",S=t.createElement(f,null),F=e=>{const{navBar:a={}}=m(),r=u(a,e),{back:i,backIcon:s,backArrow:n}=r,l=a.backIcon||S,c=h(S,a.backIcon,!0===n?l:n,!0===s?l:s);return o(r,t.createElement("div",{className:d(O)},t.createElement("div",{className:`${O}-left`,role:"button"},null!==i&&t.createElement("div",{className:`${O}-back`,onClick:r.onBack},c&&t.createElement("span",{className:`${O}-back-arrow`},c),t.createElement("span",{"aria-hidden":"true"},i)),r.left),t.createElement("div",{className:`${O}-title`},r.children),t.createElement("div",{className:`${O}-right`},r.right)))},A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return p(t,e),t.prototype.getDefaultCfg=function(){return{geomType:"area",startOnZero:!0,sortable:!0}},t.prototype.getBaseY=function(){var e=this.getY0Value(),t=this.props,a=this.startOnZero,r=t.coord,i=t.startOnZero;return(void 0===i?a:i)?r.convertPoint({x:0,y:e}).y:r.y[0]},t.prototype.mapping=function(){for(var t=e.prototype.mapping.call(this),a=this.getBaseY(),r=0,i=t.length;r<i;r++)for(var s=t[r].children,n=0,l=s.length;n<l;n++){var c=s[n],o=c.points,d=c.bottomPoints;d&&d.length?(d.reverse(),c.points=o.concat(d)):(o.unshift({x:o[0].x,y:a}),o.unshift({x:o[o.length-1].x,y:a}))}return t},t.prototype.render=function(){var e=this.props,t=e.coord,a=this.mapping(),r=this.getClip(),i=this.getBaseY();return y(M,x({},e,{baseY:i,coord:t,records:a,clip:r}))},t}(j(M=function(e){var t=e.coord,a=e.records,r=e.baseY,i=e.shape,s=e.animation,n="smooth"===i,l=t,c=l.left,o=l.top,d=l.width,m=l.height,u=l.center,h=l.startAngle,p=l.endAngle,g=l.radius,f=t.isPolar?{easing:"quadraticOut",duration:450,clip:{type:"sector",property:["endAngle"],style:{cx:u.x,cy:u.y,startAngle:"".concat(h,"rad"),r:g},start:{endAngle:"".concat(h,"rad")},end:{endAngle:"".concat(p,"rad")}}}:{easing:"quadraticOut",duration:450,clip:{type:"rect",property:["width"],style:{x:c,y:o,height:m},start:{width:0},end:{width:d}}};return y("group",null,a.map(function(e){var t=e.key,a=e.children;return y("group",{key:t},a.map(function(e){var t=e.points,a=e.topPoints,i=e.bottomPoints,l=e.color,c=e.shape;return n?y("path",{style:x({path:function(){var e=[],t=[[0,0],[1,1]],s=C(a,!1,t);e.push(["M",a[0].x,a[0].y]);for(var n=0,l=s.length;n<l;n++){var c=s[n];e.push(["C",c[1],c[2],c[3],c[4],c[5],c[6]])}if(i&&i.length){var o=C(i,!1,t);for(e.push(["L",i[0].x,i[0].y]),n=0,l=o.length;n<l;n++)c=o[n],e.push(["C",c[1],c[2],c[3],c[4],c[5],c[6]])}else e.push(["L",a[a.length-1].x,r]),e.push(["L",a[0].x,r]);return e}(),lineWidth:"2px",fill:l},c)}):y("polygon",{style:x({points:t.map(function(e){return[e.x,e.y]}),lineWidth:"2px",fill:l},c),animation:N({appear:f,update:{easing:"linear",duration:450,property:["points"]}},s)})}))}))}));var M;const T=b,$=({data:t})=>{const r=e.useMemo(()=>t.map((e,t)=>({index:t+1,value:e})),[t]);return t&&0!==t.length?a.jsx("div",{style:{width:"100%",height:"180px"},children:a.jsx(T,{pixelRatio:window.devicePixelRatio,children:a.jsxs(w,{data:r,scale:{range:{nice:!1}},children:[a.jsx(k,{field:"index",tickCount:5,formatter:()=>""}),a.jsx(k,{field:"value",tickCount:5}),a.jsx(R,{x:"index",y:"value",shape:"smooth",color:"#52c41a"}),a.jsx(A,{x:"index",y:"value",color:"l(90) 0:#52c41a 1:rgba(22,119,255,0.1)",shape:"smooth"}),a.jsx(E,{showItemMarker:!0,triggerOn:"click"})]})})}):null},B=b,V=({data:e})=>{if(!e||0===e.length)return null;const t=e.map(e=>({timeStr:g(e.date),price:e.price,date:e.date}));return a.jsx("div",{style:{width:"100%",height:"180px"},children:a.jsx(B,{pixelRatio:window.devicePixelRatio,children:a.jsxs(w,{data:t,scale:{date:{type:"timeCat",tickCount:5,mask:"MM-DD"},price:{nice:!0}},children:[a.jsx(k,{field:"timeStr",tickCount:5,style:{label:{fontSize:10}},formatter:e=>g(e).format("MM-DD")}),a.jsx(k,{field:"price",tickCount:5,style:{label:{fontSize:10}}}),a.jsx(R,{x:"timeStr",y:"price",shape:"smooth",color:"#ff8f1f"}),a.jsx(A,{x:"timeStr",y:"price",color:"l(90) 0:#ff8f1f 1:rgba(255,143,31,0.1)",shape:"smooth"}),a.jsx(E,{showItemMarker:!0,triggerOn:"click"})]})})})};var z,I,W,U;const Y=r(function(){if(U)return W;U=1;var e=I?z:(I=1,z=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,a=[],r=0;r<e.rangeCount;r++)a.push(e.getRangeAt(r));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||a.forEach(function(t){e.addRange(t)}),t&&t.focus()}}),t={"text/plain":"Text","text/html":"Url",default:"Text"};return W=function(a,r){var i,s,n,l,c,o=!1;r||(r={}),r.debug;try{if(s=e(),n=document.createRange(),l=document.getSelection(),(c=document.createElement("span")).textContent=a,c.ariaHidden="true",c.style.all="unset",c.style.position="fixed",c.style.top=0,c.style.clip="rect(0, 0, 0, 0)",c.style.whiteSpace="pre",c.style.webkitUserSelect="text",c.style.MozUserSelect="text",c.style.msUserSelect="text",c.style.userSelect="text",c.addEventListener("copy",function(e){if(e.stopPropagation(),r.format)if(e.preventDefault(),void 0===e.clipboardData){window.clipboardData.clearData();var i=t[r.format]||t.default;window.clipboardData.setData(i,a)}else e.clipboardData.clearData(),e.clipboardData.setData(r.format,a);r.onCopy&&(e.preventDefault(),r.onCopy(e.clipboardData))}),document.body.appendChild(c),n.selectNodeContents(c),l.addRange(n),!document.execCommand("copy"))throw new Error("copy command was unsuccessful");o=!0}catch(d){try{window.clipboardData.setData(r.format||"text",a),r.onCopy&&r.onCopy(window.clipboardData),o=!0}catch(m){i=function(e){var t=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return e.replace(/#{\s*key\s*}/g,t)}("message"in r?r.message:"Copy to clipboard: #{key}, Enter"),window.prompt(i,a)}}finally{l&&("function"==typeof l.removeRange?l.removeRange(n):l.removeAllRanges()),c&&document.body.removeChild(c),s()}return o}}()),q={year:"a",totalCost:"b",totalMileage:"c",avgCostPer100Km:"d",totalOil:"e",totalElectric:"f",refuelingCount:"g",chargingCount:"h",maxPriceRecord:"i",minPriceRecord:"j",maxVolumeRecord:"k",maxElectricRecord:"l",estimatedCapacity:"m",electricValues:"n",avgFuelPrice:"o",unitPrice:"p",date:"q",oil:"r",electric:"s",fuelPriceTrend:"t",price:"u"},Z=Object.entries(q).reduce((e,[t,a])=>(e[a]=t,e),{}),K=(e,t)=>Array.isArray(e)?e.map(e=>K(e,t)):null!==e&&"object"==typeof e?Object.keys(e).reduce((a,r)=>(a[t[r]||r]=K(e[r],t),a),{}):e,X=e=>{const{id:t,kilometerOfDisplay:a,...r}=e;return{...r,date:new Date(e.date).getTime()}},H=()=>{const{year:t}=i(),[r]=s(),o=n(),{recordList:d}=l(),m=r.get("data"),u=!!m,h=e.useMemo(()=>{var e,a;if(m)try{const e=JSON.parse(decodeURIComponent(m));return K(e,Z)}catch(P){return v.show("分享数据解析失败"),null}if(!t)return null;const r=parseInt(t,10),i=d.filter(e=>g(e.date).year()===r);if(0===i.length)return null;const s=i.filter(e=>"refueling"===e.type),n=i.filter(e=>"charging"===e.type),l=i.reduce((e,t)=>e+Number(t.cost),0),c=s.reduce((e,t)=>e+Number(t.oil),0),o=Number(n.reduce((e,t)=>e+Number(t.electric),0).toFixed(2)),u=[...i].sort((e,t)=>g(e.date).valueOf()-g(t.date).valueOf()),h=Number(null==(e=u[0])?void 0:e.kilometerOfDisplay)||0,p=Number(null==(a=u[u.length-1])?void 0:a.kilometerOfDisplay)||0,x=p>h?p-h:0,f=x>0?Number((l/x*100).toFixed(2)):0;let y=null,j=null,N=null,C=0;const b=[],w=e=>{const t=Number(e.cost),a=Number(e.oil);return a?t/a:0};s.sort((e,t)=>g(e.date).valueOf()-g(t.date).valueOf()),s.forEach(e=>{const t=w(e),a=Number(e.oil);t>0&&(C+=t,b.push({date:new Date(e.date).getTime(),price:Number(t.toFixed(2))})),(!y||t>w(y))&&(y=X(e)),(!j||t<w(j))&&(j=X(e)),(!N||a>Number(N.oil))&&(N=X(e))});const k=s.length>0?C/s.length:0;let R=null;const E=[];n.forEach(e=>{const t=Number(e.electric);t>0&&(E.push(t),(!R||t>Number(R.electric))&&(R=X(e)))});let L=0;if(E.length>0){E.sort((e,t)=>e-t);const e=Math.floor(.2*E.length),t=E.slice(e);if(t.length>0){const e=t.reduce((e,t)=>e+t,0)/t.length;L=Number((1.2*e).toFixed(2))}}return{year:r,totalCost:l,totalMileage:x,avgCostPer100Km:f,totalOil:c,totalElectric:o,refuelingCount:s.length,chargingCount:n.length,maxPriceRecord:y?{...y,unitPrice:w(y)}:null,minPriceRecord:j?{...j,unitPrice:w(j)}:null,maxVolumeRecord:N?{...N,unitPrice:w(N)}:null,maxElectricRecord:R,estimatedCapacity:L,electricValues:E,avgFuelPrice:k,fuelPriceTrend:b}},[d,t,m]),p=e.useRef(document.title),x=e.useRef(null);return e.useEffect(()=>{const e=document.querySelector('meta[name="description"]');e&&(x.current=e.getAttribute("content"))},[]),e.useEffect(()=>{if(!h)return;const e=`${h.year} 年度用车报告`,t=`我在${h.year}年共花费${h.totalCost.toFixed(2)}元，行驶${h.totalMileage.toFixed(0)}公里。快来看看你的吧！`;document.title=e;let a=document.querySelector('meta[name="description"]');return a||(a=document.createElement("meta"),a.setAttribute("name","description"),document.head.appendChild(a)),a.setAttribute("content",t),()=>{document.title=p.current;const e=document.querySelector('meta[name="description"]');e&&(null!==x.current?e.setAttribute("content",x.current):e.remove())}},[h]),h?a.jsxs("div",{className:"year-stat-page",children:[a.jsxs(F,{onBack:()=>o(-1),backArrow:!u,right:!u&&a.jsx("div",{style:{fontSize:20,cursor:"pointer"},onClick:()=>{if(!h)return;const e=K(h,q),t=encodeURIComponent(JSON.stringify(e)),a=window.location.href.split("?")[0];Y(`${a}?data=${t}`)?v.show({content:"链接已复制，快去分享吧",position:"top"}):v.show({content:"复制失败，请重试",position:"top"})},children:a.jsx(L,{})}),children:[h.year," 年度用车报告"]}),a.jsxs("div",{className:"content",children:[a.jsxs("div",{className:"summary-header",children:[a.jsxs("div",{className:"main-stat",children:[a.jsx("span",{className:"label",children:"年度总花费"}),a.jsxs("span",{className:"value",children:["¥",h.totalCost.toFixed(2)]})]}),a.jsxs("div",{className:"sub-stats",children:[a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"label",children:"总里程"}),a.jsxs("span",{className:"value",children:[h.totalMileage.toFixed(0)," km"]})]}),a.jsxs("div",{className:"stat-item",children:[a.jsx("span",{className:"label",children:"年度平均百公里花费"}),a.jsxs("span",{className:"value",children:["¥",h.avgCostPer100Km.toFixed(2)]})]})]})]}),a.jsxs(D,{title:"加油报告",className:"stat-card",children:[h.maxPriceRecord&&a.jsxs("div",{className:"record-row",children:[a.jsx("div",{className:"row-title",children:"单价最高"}),a.jsxs("div",{className:"row-content",children:[a.jsxs("div",{className:"highlight-value",children:["¥",h.maxPriceRecord.unitPrice.toFixed(2),"/L"]}),a.jsx("div",{className:"date",children:g(h.maxPriceRecord.date).format("MM-DD")})]})]}),h.minPriceRecord&&a.jsxs("div",{className:"record-row",children:[a.jsx("div",{className:"row-title",children:"单价最低"}),a.jsxs("div",{className:"row-content",children:[a.jsxs("div",{className:"highlight-value",children:["¥",h.minPriceRecord.unitPrice.toFixed(2),"/L"]}),a.jsx("div",{className:"date",children:g(h.minPriceRecord.date).format("MM-DD")})]})]}),h.maxVolumeRecord&&a.jsxs("div",{className:"record-row",children:[a.jsx("div",{className:"row-title",children:"单次加油最多"}),a.jsxs("div",{className:"row-content",children:[a.jsxs("div",{className:"highlight-value",children:[Number(h.maxVolumeRecord.oil).toFixed(2)," L"]}),a.jsxs("div",{className:"date",children:["¥",h.maxVolumeRecord.unitPrice.toFixed(2),"/L · ",g(h.maxVolumeRecord.date).format("MM-DD")]})]})]}),!h.maxPriceRecord&&a.jsx("div",{className:"empty-tip",children:"本年度无加油记录"}),h.fuelPriceTrend&&h.fuelPriceTrend.length>1&&a.jsxs("div",{children:[a.jsx("div",{className:"divider",style:{margin:"16px 0"}}),a.jsx("div",{style:{marginBottom:12,fontSize:15,fontWeight:500},children:"油价趋势"}),a.jsx(V,{data:h.fuelPriceTrend})]})]}),(h.maxElectricRecord||h.estimatedCapacity>0)&&a.jsxs(D,{title:"充电报告",className:"stat-card",children:[h.maxElectricRecord&&a.jsxs("div",{className:"record-row",children:[a.jsx("div",{className:"row-title",children:"单次充电最多"}),a.jsxs("div",{className:"row-content",children:[a.jsxs("div",{className:"highlight-value",children:[Number(h.maxElectricRecord.electric).toFixed(2)," kWh"]}),a.jsx("div",{className:"date",children:g(h.maxElectricRecord.date).format("MM-DD")})]})]}),h.estimatedCapacity>0&&a.jsxs("div",{className:"record-row",children:[a.jsx("div",{className:"row-title",children:"预估电池容量"}),a.jsxs("div",{className:"row-content",children:[a.jsxs("div",{className:"highlight-value",children:[h.estimatedCapacity.toFixed(2)," kWh"]}),a.jsx("div",{className:"date",children:"基于充电记录估算"})]})]}),h.electricValues.length>0&&a.jsxs("div",{children:[a.jsx($,{data:h.electricValues}),a.jsx("div",{style:{textAlign:"center",fontSize:12,color:"var(--adm-color-weak)",marginTop:8},children:"X轴：单次充电量从低到高 / Y轴：充电量 (kWh)"})]})]}),a.jsxs(D,{title:"补能统计",className:"stat-card",children:[a.jsxs("div",{className:"type-stat",children:[a.jsxs("div",{className:"type-header",children:[a.jsx("span",{className:"type-name",children:"加油"}),a.jsxs("span",{className:"count",children:["共 ",a.jsx("span",{className:"num refueling",children:h.refuelingCount})," 次， 总量: ",a.jsx("span",{className:"refueling-num",children:h.totalOil.toFixed(2)})," L"]})]}),a.jsxs("div",{className:"type-details",children:[a.jsx("span",{}),a.jsxs("span",{children:["平均每次 ",a.jsx("span",{children:Number((h.totalOil/h.refuelingCount).toFixed(2))})," L"]})]})]}),a.jsx("div",{className:"divider"}),a.jsxs("div",{className:"type-stat",children:[a.jsxs("div",{className:"type-header",children:[a.jsx("span",{className:"type-name",children:"充电"}),a.jsxs("span",{className:"count",children:["共 ",a.jsx("span",{className:"num charging",children:h.chargingCount})," 次， 总量: ",a.jsx("span",{className:"charging-num",children:h.totalElectric.toFixed(2)})," kWh"]})]}),a.jsxs("div",{className:"type-details",children:[a.jsx("span",{}),a.jsxs("span",{children:["平均每次 ",a.jsx("span",{children:Number((h.totalElectric/h.chargingCount).toFixed(2))})," kWh"]})]})]})]}),u&&a.jsx("div",{style:{padding:"20px 0 40px",textAlign:"center"},children:a.jsxs("div",{style:{display:"inline-block",padding:"10px 24px",background:"rgba(22, 119, 255, 0.1)",color:"#1677ff",borderRadius:"20px",fontSize:"14px",cursor:"pointer"},onClick:()=>{o("/")},children:["我也去记录",a.jsx(c,{})]})})]})]}):a.jsxs("div",{className:"year-stat-page",children:[a.jsx(F,{onBack:()=>o(-1),children:"年度统计"}),a.jsxs("div",{style:{padding:20,textAlign:"center"},children:["暂无 ",t," 年数据"]})]})};export{H as default};
