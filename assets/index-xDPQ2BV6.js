import{r as e,u as s,j as a,c as l,p as r,a as n}from"./index-u5DnuwxY.js";import{C as t,d as c,M as i}from"./spin-loading-DwfaOn8j.js";import{R as o,S as m}from"./switch-D2ALpwGI.js";import{B as d}from"./space-B4DpkMUn.js";import{S as h,D as u}from"./selector-CBF6-ZR2.js";function g(s){return e.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},s,{style:Object.assign({verticalAlign:"-0.125em"},s.style),className:["antd-mobile-icon",s.className].filter(Boolean).join(" ")}),e.createElement("g",{id:"EditSFill-EditSFill",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},e.createElement("g",{id:"EditSFill-编组"},e.createElement("rect",{id:"EditSFill-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),e.createElement("path",{d:"M41.5581882,38.9405779 C41.8382044,38.9405779 41.9782122,39.0765521 41.9782122,39.3485009 L41.9782122,41.592077 C41.9782122,41.8640258 41.8382044,42 41.5581882,42 L24.5472085,42 C24.2671923,42 24.1271844,41.8640258 24.1271844,41.592077 L24.1271844,39.3485009 C24.1271844,39.0765521 24.2671923,38.9405779 24.5472085,38.9405779 L41.5581882,38.9405779 Z M27.5325522,13.8391031 L34.9564907,21.0501177 C35.3664155,21.4483524 35.3664155,22.0938928 34.9564908,22.4921247 L15.217454,41.6645312 C15.0204038,41.8554216 14.7533811,41.9623153 14.4750596,41.9623153 L8.10012595,41.9623153 C6.9402636,41.9623153 6.00000168,41.0491486 6.00000168,39.9226974 L6.00000168,33.7324869 C5.99950341,33.4618321 6.1098059,33.2020832 6.30661496,33.010458 L26.0477683,13.8391032 C26.4578166,13.4409884 27.1225068,13.4409884 27.5325522,13.8391031 Z M41.5581882,32.8217298 C41.8382044,32.8217298 41.9782122,32.957704 41.9782122,33.2296528 L41.9782122,35.4732289 C41.9782122,35.7451777 41.8382044,35.8811519 41.5581882,35.8811519 L32.9477087,35.8811519 C32.6676925,35.8811519 32.5276846,35.7451777 32.5276846,35.4732289 L32.5276846,33.2296528 C32.5276846,32.957704 32.6676925,32.8217298 32.9477087,32.8217298 L41.5581882,32.8217298 Z M40.1542565,8.79202516 L40.15429,8.7910055 C42.614941,11.1803631 42.6152806,15.0546026 40.1550449,17.4443474 C40.1547933,17.4445917 40.1545418,17.444836 40.1542903,17.4450802 L38.6695064,18.8870871 C38.2911871,19.2549161 37.6955751,19.2835165 37.2834679,18.9726724 L37.1844961,18.8878895 C37.1842206,18.8876222 37.1839453,18.8873548 37.1836701,18.8870872 L29.7597261,11.6750209 C29.3498014,11.2767862 29.3498014,10.6312458 29.759726,10.233014 L31.2445098,8.79202539 C33.7049196,6.40265824 37.6938664,6.40265824 40.1542565,8.79202516 Z",id:"EditSFill-形状结合",fill:"currentColor",fillRule:"nonzero"}))))}const x={charging:"充电",refueling:"加油"},j={charging:"kWh",refueling:"L"},N=e=>{const l=s(),{id:r,type:n="charging",date:i="2024-02-28",cost:o=0,electric:m=0,oil:d=0,kilometerOfDisplay:h=0,onClick:u}=e,N=m||d;return a.jsx(t,{children:a.jsxs("div",{className:`energy-record-item ${n}`,onClick:u,children:[a.jsx("div",{className:"actions",children:a.jsx(g,{onClick:()=>{l(`/record/${String(r)}`)}})}),a.jsxs("div",{className:"record-header",children:[a.jsx("span",{className:"energy-type",children:x[n]}),a.jsx("span",{className:"record-date",children:c(i).format("YYYY.MM.DD")})]}),a.jsxs("div",{className:"record-details",children:[a.jsxs("div",{className:"detail-row",children:[a.jsx("span",{className:"label",children:"数量："}),a.jsxs("span",{className:"value",children:[N,j[n]]})]}),a.jsxs("div",{className:"detail-row",children:[a.jsx("span",{className:"label",children:"费用："}),a.jsxs("span",{className:"value",children:["¥",o]})]}),a.jsxs("div",{className:"detail-row",children:[a.jsx("span",{className:"label",children:"单价："}),a.jsxs("span",{className:"value",children:["¥",(o/N).toFixed(2),"/",j[n]]})]}),a.jsxs("div",{className:"detail-row",children:[a.jsx("span",{className:"label",children:"行驶里程："}),a.jsxs("span",{className:"value",children:[h,"km"]})]})]})]})})},p=s=>{const{month:l,mileage:r,refuelingRecords:n,chargingRecords:i,onClick:o}=s,{refuelingAmount:m,refuelingCost:d,refuelingCount:h}=e.useMemo(()=>{const e=n.reduce((e,s)=>(e.amount+=s.amount,e.cost+=s.cost,e),{amount:0,cost:0});return{refuelingAmount:Number(e.amount.toFixed(2)),refuelingCost:Number(e.cost.toFixed(2)),refuelingCount:n.length}},[n]),{chargingAmount:u,chargingCost:g,chargingCount:x}=e.useMemo(()=>{const e=i.reduce((e,s)=>(e.amount+=s.amount,e.cost+=s.cost,e),{amount:0,cost:0});return{chargingAmount:Number(e.amount.toFixed(2)),chargingCost:Number(e.cost.toFixed(2)),chargingCount:i.length}},[i]),j=e.useMemo(()=>Number((d+g).toFixed(2)),[d,g]),N=e.useMemo(()=>{if(!r||0===r)return 0;const e=Number((u/3.5).toFixed(2));return Number(((m+e)/r*100).toFixed(2))},[m,u,r]);return a.jsx(t,{children:a.jsxs("div",{className:"monthly-statistics-item",onClick:o,children:[a.jsxs("div",{className:"statistics-header",children:[a.jsx("span",{className:"month-label",children:(p=l,c(p).format("YYYY年MM月"))}),a.jsxs("div",{className:"mileage-section",children:[a.jsx("span",{className:"mileage-label",children:"总计"}),a.jsxs("span",{className:"mileage-value",children:[r||"- ","km"]}),a.jsx("span",{className:"mileage-label",children:"平均"}),a.jsxs("span",{className:"consumption-value",children:[a.jsx("span",{className:"number",children:N||"- "}),a.jsx("span",{className:"unit",children:"L/100km"})]})]})]}),a.jsxs("div",{className:"statistics-content",children:[a.jsxs("div",{className:"energy-stats",children:[a.jsxs("div",{className:"energy-item",children:[a.jsxs("div",{className:"label-group",children:[a.jsx("span",{className:"label",children:"加油"}),a.jsxs("span",{className:"count",children:[a.jsx("span",{className:"number",children:h}),a.jsx("span",{className:"text",children:"次"})]})]}),a.jsx("div",{className:"value-group",children:a.jsxs("span",{className:"value",children:[a.jsx("span",{className:"number",style:{color:"#1677ff"},children:m}),a.jsx("span",{className:"unit",children:"L"})]})})]}),a.jsxs("div",{className:"energy-item",children:[a.jsxs("div",{className:"label-group",children:[a.jsx("span",{className:"label",children:"充电"}),a.jsxs("span",{className:"count",children:[a.jsx("span",{className:"number",children:x}),a.jsx("span",{className:"text",children:"次"})]})]}),a.jsx("div",{className:"value-group",children:a.jsxs("span",{className:"value",children:[a.jsx("span",{className:"number",style:{color:"#52c41a"},children:u}),a.jsx("span",{className:"unit",children:"kWh"})]})})]})]}),a.jsxs("div",{className:"cost-formula-row",children:[a.jsx("span",{className:"label",children:"总花费"}),a.jsxs("div",{className:"formula",children:[a.jsxs("span",{className:"refueling-cost",children:[a.jsx("span",{className:"currency",children:"¥"}),d]}),a.jsx("span",{className:"separator",children:"+"}),a.jsxs("span",{className:"charging-cost",children:[a.jsx("span",{className:"currency",children:"¥"}),g]}),a.jsx("span",{className:"equals",children:"="}),a.jsxs("span",{className:"total-cost",children:[a.jsx("span",{className:"currency",children:"¥"}),j]})]})]})]})]})});var p},y=({year:e,onClick:s})=>a.jsx("div",{className:"year-stat-entry",onClick:s,children:a.jsxs("div",{className:"year-stat-content",children:[a.jsx("div",{className:"info",children:a.jsxs("div",{className:"title",children:[a.jsx("span",{className:"year-num",children:e}),"年度用车报告"]})}),a.jsx(o,{})]})}),f=l()(r(e=>({energyType:"all",month:null,onlySummary:!1,setEnergyType:s=>{e({energyType:s})},setMonth:s=>{e({month:s})},setOnlySummary:s=>{e({onlySummary:s})},resetFilters:()=>{e({energyType:"all",month:null,onlySummary:!1})}}),{name:"filter-store"})),v=({trigger:s})=>{const{energyType:l,month:r,onlySummary:n,setEnergyType:t,setMonth:o,setOnlySummary:g,resetFilters:x}=f(),[j,N]=e.useState(!1),[p,y]=e.useState(!1),v=()=>{y(!p)},C="all"!==l||null!==r||n,b=a.jsxs("div",{className:"filter-trigger-container",children:[a.jsxs("button",{className:`filter-toggle ${p?"active":""} ${C?"has-filters":""}`,onClick:v,children:["筛选",C&&a.jsx("span",{className:"filter-badge"})]}),C&&a.jsx("button",{className:"filter-reset-button",onClick:e=>{e.stopPropagation(),x()},children:"重置"})]});return a.jsxs(a.Fragment,{children:[s?a.jsx("div",{onClick:v,children:s}):b,p&&a.jsx(i,{visible:p,onMaskClick:()=>y(!1),children:a.jsxs("div",{className:"filter-container",children:[a.jsxs("div",{className:"filter-section",children:[a.jsx("div",{className:"filter-label",children:"补能类型"}),a.jsx(h,{options:[{label:"全部",value:"all"},{label:"充电",value:"charging"},{label:"加油",value:"refueling"}],value:[l],onChange:e=>{const s=e[0];t(s),y(!1)},multiple:!1,className:`filter-selector ${l}`})]}),a.jsxs("div",{className:"filter-section",children:[a.jsx("div",{className:"filter-label",children:"月份筛选"}),a.jsxs("div",{className:"month-filter",children:[a.jsx(d,{className:"month-button",onClick:()=>N(!0),fill:"outline",size:"small",children:r?c(r).format("YYYY年MM月"):"选择月份"}),r&&a.jsx(d,{className:"clear-button",onClick:()=>{o(null),y(!1)},fill:"none",size:"small",children:"清除"})]}),a.jsx(u,{visible:j,onClose:()=>N(!1),precision:"month",onConfirm:e=>{const s=c(e).format("YYYY-MM");o(s),N(!1),y(!1)},max:new Date,value:r?c(r).toDate():new Date})]}),a.jsxs("div",{className:"filter-section switch-section",children:[a.jsx("div",{className:"filter-label",children:"只看汇总"}),a.jsx(m,{checked:n,onChange:e=>{g(e),y(!1)},className:"filter-switch",style:{"--checked-color":"#ff9500","--height":"24px","--width":"44px"}})]}),a.jsx("div",{className:"filter-actions",children:a.jsx(d,{size:"small",onClick:()=>{x(),y(!1)},color:"danger",children:"重置筛选"})})]})})]})},C=()=>{const l=s(),{recordList:r}=n(),{energyType:t,month:i,onlySummary:o}=f(),m=e.useMemo(()=>{const e=r.filter(e=>{if("all"!==t&&e.type!==t)return!1;if(i){const s=c(e.date),a=c(i);if(!s.isValid()||s.year()!==a.year()||s.month()!==a.month())return!1}return!0}).sort((e,s)=>{const a=c(e.date),l=c(s.date);return a.isValid()||l.isValid()?a.isValid()?l.isValid()?a.valueOf()-l.valueOf():-1:1:0}).reduce((e,s)=>{const a=c(s.date),l=a.format("YYYY-MM"),r=a.year(),n=c();if(e.currentMonth&&e.currentMonth!==l){const s=e.currentMileage-e.lastMonthMileage;e.result.push({type:"monthodo",month:e.currentMonth,refuelingRecords:e.currentRefuelingRecords,chargingRecords:e.currentChargingRecords,mileage:s}),e.lastMonthMileage=e.currentMileage,e.currentRefuelingRecords=[],e.currentChargingRecords=[],e.currentMileage=0}if(e.currentYear&&e.currentYear!==r){const s=c(e.currentMonth).year();if(s!==r){(s<n.year()||s===n.year()&&n.month()>=11)&&e.result.push({type:"yearStat",year:s})}}return e.currentYear=r,e.currentMonth=l,"refueling"===s.type?e.currentRefuelingRecords.push({amount:Number(s.oil)||0,cost:Number(s.cost)||0}):"charging"===s.type&&e.currentChargingRecords.push({amount:Number(s.electric)||0,cost:Number(s.cost)||0}),e.currentMileage=s.kilometerOfDisplay||0,o||e.result.push({type:"energy",record:s}),e},{result:[],currentMonth:null,currentYear:null,currentRefuelingRecords:[],currentChargingRecords:[],currentMileage:0,lastMonthMileage:0});if(e.currentMonth&&(e.currentRefuelingRecords.length>0||e.currentChargingRecords.length>0)){const s=e.currentMileage-e.lastMonthMileage;e.result.push({type:"monthodo",month:e.currentMonth,refuelingRecords:e.currentRefuelingRecords,chargingRecords:e.currentChargingRecords,mileage:s});const a=c(e.currentMonth).year(),l=c();(a<l.year()||a===l.year()&&l.month()>=11)&&e.result.push({type:"yearStat",year:a})}return e.result.reverse()},[r,t,i,o]);return a.jsx("div",{className:"home-container",children:a.jsxs("section",{className:"section",children:[a.jsxs("div",{className:"section-header",children:[a.jsx("h2",{children:"补能统计"}),a.jsx(v,{})]}),a.jsx("div",{className:"energy-list",children:m.map(({type:e,record:s,...r},n)=>"yearStat"===e?a.jsx(y,{year:r.year,onClick:()=>l(`/year-stat/${r.year}`)},`year-stat-${r.year}`):"monthodo"===e?a.jsx(p,{...r,mileage:"all"!==t?null:r.mileage,onClick:()=>{}},`month-${n}`):"energy"===e?a.jsx(N,{...s,onClick:()=>{}},n):null)})]})})};export{C as default};
