import{r as e,u as s,j as l}from"./index-C8uXfnIX.js";import{d as n,c as a,p as r,u as i}from"./recordStore-DHPEKnyF.js";import{C as c,M as t,B as o}from"./space-vcm1MY0f.js";import{S as d,D as m}from"./selector-Duj5ogR4.js";import{d as u}from"./demoData-DANDD5Gv.js";function h(s){return e.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},s,{style:Object.assign({verticalAlign:"-0.125em"},s.style),className:["antd-mobile-icon",s.className].filter(Boolean).join(" ")}),e.createElement("g",{id:"EditSFill-EditSFill",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},e.createElement("g",{id:"EditSFill-编组"},e.createElement("rect",{id:"EditSFill-矩形",fill:"#FFFFFF",opacity:0,x:0,y:0,width:48,height:48}),e.createElement("path",{d:"M41.5581882,38.9405779 C41.8382044,38.9405779 41.9782122,39.0765521 41.9782122,39.3485009 L41.9782122,41.592077 C41.9782122,41.8640258 41.8382044,42 41.5581882,42 L24.5472085,42 C24.2671923,42 24.1271844,41.8640258 24.1271844,41.592077 L24.1271844,39.3485009 C24.1271844,39.0765521 24.2671923,38.9405779 24.5472085,38.9405779 L41.5581882,38.9405779 Z M27.5325522,13.8391031 L34.9564907,21.0501177 C35.3664155,21.4483524 35.3664155,22.0938928 34.9564908,22.4921247 L15.217454,41.6645312 C15.0204038,41.8554216 14.7533811,41.9623153 14.4750596,41.9623153 L8.10012595,41.9623153 C6.9402636,41.9623153 6.00000168,41.0491486 6.00000168,39.9226974 L6.00000168,33.7324869 C5.99950341,33.4618321 6.1098059,33.2020832 6.30661496,33.010458 L26.0477683,13.8391032 C26.4578166,13.4409884 27.1225068,13.4409884 27.5325522,13.8391031 Z M41.5581882,32.8217298 C41.8382044,32.8217298 41.9782122,32.957704 41.9782122,33.2296528 L41.9782122,35.4732289 C41.9782122,35.7451777 41.8382044,35.8811519 41.5581882,35.8811519 L32.9477087,35.8811519 C32.6676925,35.8811519 32.5276846,35.7451777 32.5276846,35.4732289 L32.5276846,33.2296528 C32.5276846,32.957704 32.6676925,32.8217298 32.9477087,32.8217298 L41.5581882,32.8217298 Z M40.1542565,8.79202516 L40.15429,8.7910055 C42.614941,11.1803631 42.6152806,15.0546026 40.1550449,17.4443474 C40.1547933,17.4445917 40.1545418,17.444836 40.1542903,17.4450802 L38.6695064,18.8870871 C38.2911871,19.2549161 37.6955751,19.2835165 37.2834679,18.9726724 L37.1844961,18.8878895 C37.1842206,18.8876222 37.1839453,18.8873548 37.1836701,18.8870872 L29.7597261,11.6750209 C29.3498014,11.2767862 29.3498014,10.6312458 29.759726,10.233014 L31.2445098,8.79202539 C33.7049196,6.40265824 37.6938664,6.40265824 40.1542565,8.79202516 Z",id:"EditSFill-形状结合",fill:"currentColor",fillRule:"nonzero"}))))}const g={charging:"充电",refueling:"加油"},x={charging:"kWh",refueling:"L"},j=e=>{const a=s(),{id:r,type:i="charging",date:t="2024-02-28",cost:o=0,electric:d=0,oil:m=0,kilometerOfDisplay:u=0,onClick:j}=e,N=d||m;return l.jsx(c,{children:l.jsxs("div",{className:`energy-record-item ${i}`,onClick:j,children:[l.jsx("div",{className:"actions",children:l.jsx(h,{onClick:()=>{a(`/record/${String(r)}`)}})}),l.jsxs("div",{className:"record-header",children:[l.jsx("span",{className:"energy-type",children:g[i]}),l.jsx("span",{className:"record-date",children:n(t).format("YYYY.MM.DD")})]}),l.jsxs("div",{className:"record-details",children:[l.jsxs("div",{className:"detail-row",children:[l.jsx("span",{className:"label",children:"数量："}),l.jsxs("span",{className:"value",children:[N,x[i]]})]}),l.jsxs("div",{className:"detail-row",children:[l.jsx("span",{className:"label",children:"费用："}),l.jsxs("span",{className:"value",children:["¥",o]})]}),l.jsxs("div",{className:"detail-row",children:[l.jsx("span",{className:"label",children:"单价："}),l.jsxs("span",{className:"value",children:["¥",(o/N).toFixed(2),"/",x[i]]})]}),l.jsxs("div",{className:"detail-row",children:[l.jsx("span",{className:"label",children:"行驶里程："}),l.jsxs("span",{className:"value",children:[u,"km"]})]})]})]})})},N=s=>{const{month:a,mileage:r,refuelingRecords:i,chargingRecords:t,onClick:o}=s,{refuelingAmount:d,refuelingCost:m,refuelingCount:u}=e.useMemo((()=>{const e=i.reduce(((e,s)=>(e.amount+=s.amount,e.cost+=s.cost,e)),{amount:0,cost:0});return{refuelingAmount:Number(e.amount.toFixed(2)),refuelingCost:Number(e.cost.toFixed(2)),refuelingCount:i.length}}),[i]),{chargingAmount:h,chargingCost:g,chargingCount:x}=e.useMemo((()=>{const e=t.reduce(((e,s)=>(e.amount+=s.amount,e.cost+=s.cost,e)),{amount:0,cost:0});return{chargingAmount:Number(e.amount.toFixed(2)),chargingCost:Number(e.cost.toFixed(2)),chargingCount:t.length}}),[t]),j=e.useMemo((()=>Number((m+g).toFixed(2))),[m,g]),N=e.useMemo((()=>{if(!r||0===r)return 0;const e=Number((h/3.5).toFixed(2));return Number(((d+e)/r*100).toFixed(2))}),[d,h,r]);return l.jsx(c,{children:l.jsxs("div",{className:"monthly-statistics-item",onClick:o,children:[l.jsxs("div",{className:"statistics-header",children:[l.jsx("span",{className:"month-label",children:(p=a,n(p).format("YYYY年MM月"))}),l.jsxs("div",{className:"mileage-section",children:[l.jsx("span",{className:"mileage-label",children:"总计"}),l.jsxs("span",{className:"mileage-value",children:[r||"- ","km"]}),l.jsx("span",{className:"mileage-label",children:"平均"}),l.jsxs("span",{className:"consumption-value",children:[l.jsx("span",{className:"number",children:N||"- "}),l.jsx("span",{className:"unit",children:"L/100km"})]})]})]}),l.jsxs("div",{className:"statistics-content",children:[l.jsxs("div",{className:"energy-stats",children:[l.jsxs("div",{className:"energy-item",children:[l.jsxs("div",{className:"label-group",children:[l.jsx("span",{className:"label",children:"加油"}),l.jsxs("span",{className:"count",children:[l.jsx("span",{className:"number",children:u}),l.jsx("span",{className:"text",children:"次"})]})]}),l.jsx("div",{className:"value-group",children:l.jsxs("span",{className:"value",children:[l.jsx("span",{className:"number",style:{color:"#1677ff"},children:d}),l.jsx("span",{className:"unit",children:"L"})]})})]}),l.jsxs("div",{className:"energy-item",children:[l.jsxs("div",{className:"label-group",children:[l.jsx("span",{className:"label",children:"充电"}),l.jsxs("span",{className:"count",children:[l.jsx("span",{className:"number",children:x}),l.jsx("span",{className:"text",children:"次"})]})]}),l.jsx("div",{className:"value-group",children:l.jsxs("span",{className:"value",children:[l.jsx("span",{className:"number",style:{color:"#52c41a"},children:h}),l.jsx("span",{className:"unit",children:"kWh"})]})})]})]}),l.jsxs("div",{className:"cost-formula-row",children:[l.jsx("span",{className:"label",children:"总花费"}),l.jsxs("div",{className:"formula",children:[l.jsxs("span",{className:"refueling-cost",children:[l.jsx("span",{className:"currency",children:"¥"}),m]}),l.jsx("span",{className:"separator",children:"+"}),l.jsxs("span",{className:"charging-cost",children:[l.jsx("span",{className:"currency",children:"¥"}),g]}),l.jsx("span",{className:"equals",children:"="}),l.jsxs("span",{className:"total-cost",children:[l.jsx("span",{className:"currency",children:"¥"}),j]})]})]})]})]})});var p},p=a()(r((e=>({energyType:"all",month:null,setEnergyType:s=>{e({energyType:s})},setMonth:s=>{e({month:s})},resetFilters:()=>{e({energyType:"all",month:null})}})),{name:"filter-store"})),f=({trigger:s})=>{const{energyType:a,month:r,setEnergyType:i,setMonth:c,resetFilters:u}=p(),[h,g]=e.useState(!1),[x,j]=e.useState(!1),N=()=>{j(!x)},f="all"!==a||null!==r,v=l.jsxs("div",{className:"filter-trigger-container",children:[l.jsxs("button",{className:`filter-toggle ${x?"active":""} ${f?"has-filters":""}`,onClick:N,children:["筛选",f&&l.jsx("span",{className:"filter-badge"})]}),f&&l.jsx("button",{className:"filter-reset-button",onClick:e=>{e.stopPropagation(),u()},children:"重置"})]});return l.jsxs(l.Fragment,{children:[s?l.jsx("div",{onClick:N,children:s}):v,x&&l.jsx(t,{visible:x,onMaskClick:()=>j(!1),children:l.jsxs("div",{className:"filter-container",children:[l.jsxs("div",{className:"filter-section",children:[l.jsx("div",{className:"filter-label",children:"补能类型"}),l.jsx(d,{options:[{label:"全部",value:"all"},{label:"充电",value:"charging"},{label:"加油",value:"refueling"}],value:[a],onChange:e=>{const s=e[0];i(s),j(!1)},multiple:!1,className:`filter-selector ${a}`})]}),l.jsxs("div",{className:"filter-section",children:[l.jsx("div",{className:"filter-label",children:"月份筛选"}),l.jsxs("div",{className:"month-filter",children:[l.jsx(o,{className:"month-button",onClick:()=>g(!0),fill:"outline",size:"small",children:r?n(r).format("YYYY年MM月"):"选择月份"}),r&&l.jsx(o,{className:"clear-button",onClick:()=>{c(null),j(!1)},fill:"none",size:"small",children:"清除"})]}),l.jsx(m,{visible:h,onClose:()=>g(!1),precision:"month",onConfirm:e=>{const s=n(e).format("YYYY-MM");c(s),g(!1),j(!1)},max:new Date})]}),l.jsx("div",{className:"filter-actions",children:l.jsx(o,{size:"small",onClick:()=>{u(),j(!1)},color:"danger",children:"重置筛选"})})]})})]})},v=()=>{const{recordList:s}=i(),{energyType:a,month:r}=p(),c=(null==s?void 0:s.length)>0,t=e.useMemo((()=>{const e=(c?s:u).filter((e=>{if("all"!==a&&e.type!==a)return!1;if(r){const s=n(e.date),l=n(r);if(!s.isValid()||s.year()!==l.year()||s.month()!==l.month())return!1}return!0})).sort(((e,s)=>{const l=n(e.date),a=n(s.date);return l.isValid()||a.isValid()?l.isValid()?a.isValid()?l.valueOf()-a.valueOf():-1:1:0})).reduce(((e,s)=>{const l=n(s.date).format("YYYY-MM");if(e.currentMonth&&e.currentMonth!==l){const s=e.currentMileage-e.lastMonthMileage;e.result.push({type:"monthodo",month:e.currentMonth,refuelingRecords:e.currentRefuelingRecords,chargingRecords:e.currentChargingRecords,mileage:s}),e.lastMonthMileage=e.currentMileage,e.currentRefuelingRecords=[],e.currentChargingRecords=[],e.currentMileage=0}return e.currentMonth=l,"refueling"===s.type?e.currentRefuelingRecords.push({amount:Number(s.oil)||0,cost:Number(s.cost)||0}):"charging"===s.type&&e.currentChargingRecords.push({amount:Number(s.electric)||0,cost:Number(s.cost)||0}),e.currentMileage=s.kilometerOfDisplay||0,e.result.push({type:"energy",record:s}),e}),{result:[],currentMonth:null,currentRefuelingRecords:[],currentChargingRecords:[],currentMileage:0,lastMonthMileage:0});if(e.currentMonth&&(e.currentRefuelingRecords.length>0||e.currentChargingRecords.length>0)){const s=e.currentMileage-e.lastMonthMileage;e.result.push({type:"monthodo",month:e.currentMonth,refuelingRecords:e.currentRefuelingRecords,chargingRecords:e.currentChargingRecords,mileage:s})}return e.result.reverse()}),[s,a,r,c]);return l.jsx("div",{className:"home-container",children:l.jsxs("section",{className:"section",children:[l.jsxs("div",{className:"section-header",children:[l.jsxs("h2",{children:["补能统计",!c&&"(DEMO MODE)"]}),l.jsx(f,{})]}),l.jsx("div",{className:"energy-list",children:t.map((({type:e,record:s,...n},r)=>"monthodo"===e?l.jsx(N,{...n,mileage:"all"!==a?null:n.mileage,onClick:()=>{}},`month-${r}`):"energy"===e?l.jsx(j,{...s,onClick:()=>{}},r):null))})]})})};export{v as default};
